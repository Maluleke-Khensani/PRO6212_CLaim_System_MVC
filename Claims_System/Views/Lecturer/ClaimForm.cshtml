@model Claims_System.Models.LecturerClaim
@{
    ViewData["Title"] = "Create Monthly Claim";
}

@if (TempData["Success"] != null)
{
    <div class="alert alert-primary" role="alert">
        @TempData["Success"]
    </div>
}
@if (TempData["Error"] != null)
{
    <div class="alert alert-secondary" role="alert">
        @TempData["Error"]
    </div>
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h5 mb-0">Create Monthly Claim</h1>
    <a class="btn btn-link" asp-action="Index">Back to dashboard</a>
</div>

<div class="card mb-3 shadow-sm border-0">
    <div class="card-body">
        <form asp-action="ClaimForm" enctype="multipart/form-data" method="post">
            <div asp-validation-summary="All" class="text-danger"></div>
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <p>@Model.Username</p>
            <input type="hidden" asp-for="Username" />
            <input type="text" class="form-control" asp-for="Username" readonly />


            <div class="row g-3">
                <div class="col-sm-4">
                    <label class="form-label">Month</label>
                    <select asp-for="Month" class="form-select">
                        @for (int m = 1; m <= 12; m++)
                        {
                            <option value="@m">@System.Globalization.CultureInfo.CurrentCulture.DateTimeFormat.GetMonthName(m)
                            </option>
                        }
                    </select>
                    <span asp-validation-for="Month" class="text-danger"></span>
                </div>

                <div class="col-sm-4">
                    <label class="form-label">Year</label>
                    <select asp-for="Year" class="form-select">
                        @for (int y = DateTime.Now.Year; y <= DateTime.Now.Year + 3; y++)
                        {
                            <option value="@y">@y</option>
                        }
                    </select>
                    <span asp-validation-for="Year" class="text-danger"></span>
                </div>

                <div class="col-sm-4">
                    <label class="form-label">Submitted</label>
                    <input asp-for="Submitted" type="date" class="form-control" />
                    <span asp-validation-for="Submitted" class="text-danger"></span>
                </div>
            </div>

            <hr />
            <h6>Claim Details</h6>

            <table class="table table-sm align-middle">
                <thead>
                    <tr>
                        <th>Full Name</th>
                        <th>Module</th>
                        <th>Hours</th>
                        <th>Rate</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input asp-for="FullName" class="form-control" /></td>
                        <td>
                            <select asp-for="ModuleName" class="form-select">
                                <option>Programming 1A</option>
                                <option>Cloud Development</option>
                                <option>Database Systems</option>
                            </select>
                        </td>
                        <td><input asp-for="HoursWorked" type="number" step="0.1" class="form-control" id="hoursInput" /></td>
                        <td><input asp-for="Rate" class="form-control" readonly id="rateInput" /></td>
                        <td><input type="text" id="totalInput" class="form-control" readonly /></td>
                    </tr>
                </tbody>
            </table>

            <div class="mb-3">
                <label class="form-label">Notes</label>
                <textarea asp-for="Notes" class="form-control" rows="3" placeholder="Add any relevant notes"></textarea>
            </div>

            <div class="mb-3">
                <label class="form-label">Supporting documents</label>
                <input name="Document1" type="file" class="form-control mb-2" />
                <input name="Document2" type="file" class="form-control" />
                <div class="form-text">Allowed: .pdf, .docx, .xlsx (Max 5MB)</div>
            </div>

            <div class="mt-3">
                <button type="submit" class="btn btn-primary">Submit claim</button>
                <a class="btn btn-secondary ms-2" asp-action="Index">Cancel</a>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        // Auto-calculate total
        document.getElementById("hoursInput").addEventListener("input", function () {
            var hours = parseFloat(this.value) || 0;
            var rate = parseFloat(document.getElementById("rateInput").value) || 0;
            var total = hours * rate;
            document.getElementById("totalInput").value = "R " + total.toFixed(2);
        });
    </script>
}
